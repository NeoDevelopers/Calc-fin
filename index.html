<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>CRM v8.0</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

  <div id="toast-container"></div>

  <div class="nav">
    <button class="nav-btn active" onclick="setTab('calc')" id="nav-calc">üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</button>
    <button class="nav-btn" onclick="setTab('queue')" id="nav-queue">üìã –û—á–µ—Ä–µ–¥—å</button>
    <button class="nav-btn" onclick="setTab('history')" id="nav-history">üìÇ –ê—Ä—Ö–∏–≤</button>
    <button class="nav-btn nav-icon-btn" onclick="logout()" style="color:var(--red); margin-left:5px;">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
        <polyline points="16 17 21 12 16 7"></polyline>
        <line x1="21" y1="12" x2="9" y2="12"></line>
      </svg>
    </button>
  </div>

  <div id="login-screen" class="modal show" style="z-index: 2000;">
    <div class="modal-content login-card" style="text-align: center;">
      <div class="logo">CRM</div>
      <select id="user-select" class="custom-input compact-input" onchange="validateLoginInput()">
        <option value="" disabled selected>–ö—Ç–æ –≤—ã?</option>
        <option value="–í–ª–∞–¥–µ–ª–µ—Ü">üëë –í–ª–∞–¥–µ–ª–µ—Ü</option>
        <option value="–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞">üåπ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞</option>
        <option value="–ú–∏—Ö–∞–∏–ª">üëî –ú–∏—Ö–∞–∏–ª</option>
        <option value="–†–æ–º–∞">üî® –†–æ–º–∞</option>
        <option value="–î–∏–º–∞">üî® –î–∏–º–∞</option>
      </select>
      <input type="password" id="user-pass" class="custom-input compact-input" placeholder="–ü–∞—Ä–æ–ª—å" inputmode="numeric" oninput="validateLoginInput()">
      <button class="main-btn" id="login-btn" onclick="handleLogin()" disabled>–í–æ–π—Ç–∏</button>
    </div>
  </div>

  <div id="tab-calc" class="tab active">
    <div class="card">
      <div class="preview-container">
        <div class="preview-box" id="preview-box">
          <span class="dim-label dim-w" id="dim-w-label">‚Äî</span>
          <span class="dim-label dim-h" id="dim-h-label">‚Äî</span>
        </div>
      </div>
      <div id="mount-info" class="mount-info"></div>
    </div>

    <div class="card">
      <div class="unit-toggle-container">
        <div class="unit-toggle">
          <button id="unit-cm" class="active" onclick="setUnit('cm')">—Å–º</button>
          <button id="unit-mm" onclick="setUnit('mm')">–º–º</button>
        </div>
      </div>
      <div class="input-row">
        <div>
          <label class="input-label">–®–∏—Ä–∏–Ω–∞ <span id="unit-label-width">(—Å–º)</span></label>
          <input type="number" id="c-w" class="custom-input" placeholder="100" oninput="calc()" style="margin-bottom:0">
        </div>
        <div>
          <label class="input-label">–í—ã—Å–æ—Ç–∞ <span id="unit-label-height">(—Å–º)</span></label>
          <input type="number" id="c-h" class="custom-input" placeholder="50" oninput="calc()" style="margin-bottom:0">
        </div>
      </div>
      <label class="input-label" style="margin-top:10px;">–õ–∏—Å—Ç–æ–≤ –∞–∫—Ä–∏–ª–∞ –ø–æ –Ω–µ—Å—Ç–∏–Ω–≥—É</label>
      <div class="stepper">
        <button class="step-btn" onclick="stepSheets(-0.1)">‚àí</button>
        <input type="number" id="c-s" class="custom-input" style="border:none; background:transparent; margin-bottom:0" value="1.0" step="0.1" oninput="calc()">
        <button class="step-btn" onclick="stepSheets(0.1)">+</button>
      </div>
    </div>

    <div class="card">
      <div class="toggle-container"><span class="toggle-label">üåà –ü–ª–µ–Ω–∫–∞ (+30%)</span><label class="switch"><input type="checkbox" id="c-film" onchange="calc()"><span class="slider"></span></label></div>
      <div class="toggle-container"><span class="toggle-label">üí° –ü–æ–¥—Å–≤–µ—Ç–∫–∞</span><label class="switch"><input type="checkbox" id="c-light" onchange="calc()"><span class="slider"></span></label></div>
      <div class="toggle-container"><span class="toggle-label">ü§Ø –°–ª–æ–∂–Ω—ã–π –º–∞–∫–µ—Ç (—Ö1.4)</span><label class="switch"><input type="checkbox" id="c-complex" onchange="calc()"><span class="slider"></span></label></div>
    </div>

    <div class="result-box">
      <div class="result-title">–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï</div>
      <div id="price-display" class="price-big">0 ‚ÇΩ</div>
    </div>

    <button class="main-btn" id="order-btn-ui" onclick="openOrderModal()" style="display:none; margin-bottom:12px;">üìã –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    <button class="settings-btn" id="admin-settings-btn" onclick="toggleSettingsPanel()" style="display:none;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞</button>

    <div class="settings-panel" id="settings-panel">
      <div class="settings-row"><label>–û—Å–Ω–æ–≤–∞ (‚ÇΩ/–º¬≤)</label><input type="number" id="s-base" oninput="saveAdminSettings()"></div>
      <div class="settings-row"><label>–ê–∫—Ä–∏–ª (‚ÇΩ/–ª–∏—Å—Ç)</label><input type="number" id="s-acrylic" oninput="saveAdminSettings()"></div>
      <div class="settings-row"><label>–†–∞–±–æ—Ç–∞ (–º–Ω–æ–∂–∏—Ç–µ–ª—å)</label><input type="number" id="s-labor" step="0.1" oninput="saveAdminSettings()"></div>
      <div class="settings-row"><label>–†–∞—Å—Ö–æ–¥—ã (‚ÇΩ/–º¬≤)</label><input type="number" id="s-overhead" oninput="saveAdminSettings()"></div>
      <div class="settings-row"><label>–§–∏–∫—Å —Ä–∞—Å—Ö–æ–¥ (‚ÇΩ)</label><input type="number" id="s-setup" oninput="saveAdminSettings()"></div>
      <div class="settings-row"><label>–ú–∞—Ä–∂–∞ –º–∞–∫—Å</label><input type="number" id="s-m-small" step="0.1" oninput="saveAdminSettings()"></div>
      <div class="settings-row"><label>–ú–∞—Ä–∂–∞ –º–∏–Ω</label><input type="number" id="s-m-large" step="0.1" oninput="saveAdminSettings()"></div>
      <div class="settings-row"><label>–°–∫–∏–¥–∫–∞ –∞–∫—Ä–∏–ª max (%)</label><input type="number" id="s-acrylic-disc" oninput="saveAdminSettings()"></div>
      <div class="settings-row"><label>–°–∫–∏–¥–∫–∞ –æ—Å–Ω–æ–≤–∞ max (%)</label><input type="number" id="s-base-disc" oninput="saveAdminSettings()"></div>
      <div class="settings-row"><label>–ü–ª–µ–Ω–∫–∞ (–∫–æ—ç—Ñ—Ñ.)</label><input type="number" id="s-film" step="0.1" oninput="saveAdminSettings()"></div>
      <div class="settings-row"><label>–°–ª–æ–∂–Ω–æ—Å—Ç—å (–∫–æ—ç—Ñ—Ñ.)</label><input type="number" id="s-complex" step="0.1" oninput="saveAdminSettings()"></div>
      <div class="settings-row"><label>–ü–æ–¥—Å–≤–µ—Ç–∫–∞ (—Ñ–∏–∫—Å, ‚ÇΩ)</label><input type="number" id="s-light-fix" oninput="saveAdminSettings()"></div>
      <div class="settings-row"><label>–ü–æ–¥—Å–≤–µ—Ç–∫–∞ (‚ÇΩ/–º¬≤)</label><input type="number" id="s-light-m2" oninput="saveAdminSettings()"></div>
      <hr style="margin:10px 0; opacity:0.1;">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <span style="font-size:12px; color:var(--hint);">–°–∫—Ä—ã–≤–∞—Ç—å —Ü–µ–Ω—ã —Ü–µ—Ö—É</span>
        <input type="checkbox" id="sett-price" style="width:18px; height:18px;" onchange="updateGlobalPriceSetting()">
      </div>
      <button class="reset-btn" onclick="resetToDefaults()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
    </div>
  </div>

  <div id="tab-queue" class="tab" style="display:none;">
    <div id="loader-queue" style="text-align:center; padding:20px; color:var(--hint);">–ó–∞–≥—Ä—É–∑–∫–∞ –æ—á–µ—Ä–µ–¥–∏...</div>
    <div id="queue-list"></div>
  </div>

  <div id="tab-history" class="tab" style="display:none;">
    <div id="loader-history" style="text-align:center; padding:20px; color:var(--hint);">–ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ö–∏–≤–∞...</div>
    <div id="history-list"></div>
  </div>

  <div class="modal" id="modal-new">
    <div class="modal-content">
      <h3>–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h3>
      <input type="text" id="n-client" class="custom-input compact-input" placeholder="üë§ –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞">
      <input type="tel" id="n-phone" class="custom-input compact-input" placeholder="üìû –¢–µ–ª–µ—Ñ–æ–Ω / –ö–æ–Ω—Ç–∞–∫—Ç">
      <div class="file-row">
        <label class="file-custom" id="lbl-photo"><span>üì∏ –§–æ—Ç–æ</span><input type="file" id="n-photo" onchange="updateFileLabel(this, 'lbl-photo')"></label>
        <label class="file-custom" id="lbl-layout"><span>üìÇ –ú–∞–∫–µ—Ç</span><input type="file" id="n-layout" onchange="updateFileLabel(this, 'lbl-layout')"></label>
      </div>
      <textarea id="n-desc" class="custom-input compact-input" style="min-height:60px;" placeholder="üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."></textarea>
      <button class="main-btn" onclick="submitOrder()">üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —Ä–∞–±–æ—Ç—É</button>
      <button class="btn-action" onclick="closeModals()">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <div class="modal" id="modal-edit">
    <div class="modal-content">
      <h3 id="edit-id-title">–ó–∞–∫–∞–∑</h3>
      <select id="e-status" class="custom-input compact-input" onchange="checkStatusReq()">
        <option>–ù–æ–≤—ã–π</option><option>–í —Ä–∞–±–æ—Ç–µ</option><option>–ì–æ—Ç–æ–≤</option><option>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</option>
      </select>
      <div id="finish-reqs" style="display:none; background:rgba(48, 209, 88, 0.1); padding:10px; border-radius:12px; margin-bottom:10px;">
        <label class="file-custom" id="lbl-e-photo"><span>üì∏ –§–æ—Ç–æ –≥–æ—Ç–æ–≤–æ–≥–æ</span><input type="file" id="e-photo" onchange="updateFileLabel(this, 'lbl-e-photo')"></label>
        <input type="text" id="e-tk" class="custom-input compact-input" placeholder="üöö ‚Ññ –ù–∞–∫–ª–∞–¥–Ω–æ–π –¢–ö">
      </div>
      <input type="number" id="e-paid-add" class="custom-input compact-input" placeholder="üí∞ –í–Ω–µ—Å—Ç–∏ –¥–æ–ø–ª–∞—Ç—É (‚ÇΩ)">
      <button class="main-btn" id="btn-update" onclick="updateOrder()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="btn-action" onclick="closeModals()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <script src="config.js"></script>
  <script src="script.js"></script>
</body>
</html>
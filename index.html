<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>CRM v2.3</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

  <div id="toast-container"></div>

  <div class="nav">
    <button class="nav-btn active" onclick="setTab('calc')" id="nav-calc">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><path d="M8 6h8M8 10h8M8 14h4M12 18v-4"/></svg>
      –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
    </button>
    <button class="nav-btn" onclick="setTab('queue')" id="nav-queue">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
      –û—á–µ—Ä–µ–¥—å
    </button>
    <button class="nav-btn" onclick="setTab('history')" id="nav-history">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
      –ê—Ä—Ö–∏–≤
    </button>
    <button class="nav-btn nav-icon-btn" onclick="logout()" style="color:var(--red);">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
    </button>
  </div>

  <div id="login-screen" class="modal show" style="z-index: 2000;">
    <div class="modal-content login-card" style="text-align: center;">
      <div class="logo">CRM PRO</div>
      <select id="user-select" class="custom-input compact-input" onchange="validateLoginInput()">
        <option value="" disabled selected>–ö—Ç–æ –≤—ã?</option>
        <option value="–í–ª–∞–¥–µ–ª–µ—Ü">üëë –í–ª–∞–¥–µ–ª–µ—Ü</option>
        <option value="–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞">üåπ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞</option>
        <option value="–ú–∏—Ö–∞–∏–ª">üëî –ú–∏—Ö–∞–∏–ª</option>
        <option value="–†–æ–º–∞">üî® –†–æ–º–∞</option>
        <option value="–î–∏–º–∞">üî® –î–∏–º–∞</option>
      </select>
      <input type="password" id="user-pass" class="custom-input compact-input" placeholder="–ü–∞—Ä–æ–ª—å" inputmode="numeric" oninput="validateLoginInput()">
      <button class="main-btn" id="login-btn" onclick="handleLogin()" disabled>–í–æ–π—Ç–∏</button>
    </div>
  </div>

  <div id="tab-calc" class="tab active">
    
    <div class="card preview-card" id="preview-card">
      <div class="preview-container">
        <div class="preview-box" id="preview-box">
          <span class="dim-label dim-w" id="dim-w-label">‚Äî</span>
          <span class="dim-label dim-h" id="dim-h-label">‚Äî</span>
        </div>
      </div>
      <div id="mount-info" class="mount-info"></div>
    </div>

    <div class="card">
      <div class="unit-toggle-container">
        <div class="unit-toggle">
          <button id="unit-cm" class="active" onclick="setUnit('cm')">—Å–º</button>
          <button id="unit-mm" onclick="setUnit('mm')">–º–º</button>
        </div>
      </div>
      <div class="input-row">
        <div>
          <label class="input-label">–®–∏—Ä–∏–Ω–∞ <span id="unit-label-width">(—Å–º)</span></label>
          <input type="number" id="c-w" class="custom-input" placeholder="0" oninput="calc()" style="margin-bottom:0">
        </div>
        <div>
          <label class="input-label">–í—ã—Å–æ—Ç–∞ <span id="unit-label-height">(—Å–º)</span></label>
          <input type="number" id="c-h" class="custom-input" placeholder="0" oninput="calc()" style="margin-bottom:0">
        </div>
      </div>
      <label class="input-label" style="margin-top:var(--gap);">–õ–∏—Å—Ç–æ–≤ –∞–∫—Ä–∏–ª–∞ –ø–æ –Ω–µ—Å—Ç–∏–Ω–≥—É</label>
      <div class="stepper">
        <button class="step-btn" onclick="stepSheets(-0.1)">‚àí</button>
        <input type="number" id="c-s" class="custom-input" style="border:none; background:transparent; margin-bottom:0" value="1.5" step="0.1" oninput="calc()">
        <button class="step-btn" onclick="stepSheets(0.1)">+</button>
      </div>
    </div>

    <div class="card">
      <div class="toggle-container"><span class="toggle-label">üåà –ü–ª–µ–Ω–∫–∞ (+30% –∫ –∞–∫—Ä–∏–ª—É)</span><label class="switch"><input type="checkbox" id="c-film" onchange="calc()"><span class="slider"></span></label></div>
      <div class="toggle-container"><span class="toggle-label">üí° –ü–æ–¥—Å–≤–µ—Ç–∫–∞</span><label class="switch"><input type="checkbox" id="c-light" onchange="calc()"><span class="slider"></span></label></div>
      <div class="toggle-container"><span class="toggle-label">ü§Ø –°–ª–æ–∂–Ω—ã–π –º–∞–∫–µ—Ç (—Ö1.4)</span><label class="switch"><input type="checkbox" id="c-complex" onchange="calc()"><span class="slider"></span></label></div>
    </div>

    <div class="result-box">
      <div class="result-title">–ò–¢–û–ì–û</div>
      <div id="price-display" class="price-big">0 ‚ÇΩ</div>

      <div class="cost-breakdown" id="cost-breakdown" style="display:none;">
        <div class="cost-row"><span>–û—Å–Ω–æ–≤–∞ + –†–∞–±–æ—Ç–∞:</span><span class="cost-val" id="price-base">0 ‚ÇΩ</span></div>
        <div class="cost-row"><span>–ê–∫—Ä–∏–ª:</span><span class="cost-val" id="price-acrylic">0 ‚ÇΩ</span></div>
        <div class="cost-row" id="row-film" style="display:none;"><span>–ü–ª–µ–Ω–∫–∞:</span><span class="cost-val" id="price-film">0 ‚ÇΩ</span></div>
        <div class="cost-row" id="row-light" style="display:none;"><span>–ü–æ–¥—Å–≤–µ—Ç–∫–∞:</span><span class="cost-val" id="price-light">0 ‚ÇΩ</span></div>
        <div class="cost-row main" id="row-complex" style="display:none;"><span>+ –°–ª–æ–∂–Ω–æ—Å—Ç—å:</span><span class="cost-val" id="price-complex">0 ‚ÇΩ</span></div>
      </div>
    </div>

    <button class="main-btn" id="order-btn-ui" onclick="openOrderModal()" style="display:none; margin-bottom:12px;">üìã –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    <button class="settings-btn" id="admin-settings-btn" onclick="toggleSettingsPanel()" style="display:none;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>

    <div class="settings-panel" id="settings-panel">
       <div class="warning-box">–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è –≤–∞—à–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.</div>
       <div class="settings-row"><label>–û—Å–Ω–æ–≤–∞ (‚ÇΩ/–º¬≤)</label><input type="number" id="s-base" oninput="saveAdminSettings()"></div>
       <div class="settings-row"><label>–ê–∫—Ä–∏–ª (‚ÇΩ/–ª–∏—Å—Ç)</label><input type="number" id="s-acrylic" oninput="saveAdminSettings()"></div>
       <div class="settings-row"><label>–†–∞–±–æ—Ç–∞ (–º–Ω–æ–∂–∏—Ç–µ–ª—å)</label><input type="number" id="s-labor" step="0.1" oninput="saveAdminSettings()"></div>
       <div class="settings-row"><label>–ú–∞—Ä–∂–∞ –º–∞–∫—Å</label><input type="number" id="s-m-small" step="0.1" oninput="saveAdminSettings()"></div>
       <div class="settings-row"><label>–ú–∞—Ä–∂–∞ –º–∏–Ω</label><input type="number" id="s-m-large" step="0.1" oninput="saveAdminSettings()"></div>
       <div class="settings-row"><label>–°–∫–∏–¥–∫–∞ –∞–∫—Ä–∏–ª (%)</label><input type="number" id="s-acrylic-disc" oninput="saveAdminSettings()"></div>
       <div class="settings-row"><label>–°–∫–∏–¥–∫–∞ –æ—Å–Ω–æ–≤–∞ (%)</label><input type="number" id="s-base-disc" oninput="saveAdminSettings()"></div>
       <button class="reset-btn" onclick="resetToDefaults()">üîÑ –°–±—Ä–æ—Å</button>
    </div>
  </div>

  <div id="tab-queue" class="tab" style="display:none;">
    <button class="add-order-btn" onclick="openOrderModal()">+ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
    <div class="card" style="margin-top:10px;">
      <div id="loader-queue" style="text-align:center; padding:20px; color:var(--hint);">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      <div id="queue-list"></div>
    </div>
  </div>

  <div id="tab-history" class="tab" style="display:none;">
    <div class="card">
      <div id="loader-history" style="text-align:center; padding:20px; color:var(--hint);">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      <div id="history-list"></div>
    </div>
  </div>

  <div class="modal" id="modal-new">
    <div class="modal-content">
      <h3>–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h3>
      
      <label class="input-label">–î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞</label>
      <div class="input-row">
        <input type="text" id="n-client" class="custom-input compact-input" placeholder="üë§ –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞">
        <input type="tel" id="n-phone" class="custom-input compact-input" placeholder="üìû –¢–µ–ª–µ—Ñ–æ–Ω">
      </div>
      
      <label class="input-label">–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</label>
      <div class="delivery-chips" id="n-delivery-chips">
        <button class="chip" onclick="selectDelivery('n', 'pickup', this)">–°–∞–º–æ–≤—ã–≤–æ–∑</button>
        <button class="chip" onclick="selectDelivery('n', 'yandex', this)">–Ø–Ω–¥–µ–∫—Å</button>
        <button class="chip" onclick="selectDelivery('n', 'cdek', this)">–°–î–≠–ö</button>
      </div>
      <input type="text" id="n-track" class="custom-input compact-input" placeholder="–ù–æ–º–µ—Ä –Ω–∞–∫–ª–∞–¥–Ω–æ–π –°–î–≠–ö" style="display:none; margin-top:8px;">

      <div class="file-row" style="margin-top:12px;">
        <label class="file-custom" id="lbl-n-photo"><span>üì∏ –§–æ—Ç–æ</span><input type="file" id="n-photo" onchange="updateFileLabel(this, 'lbl-n-photo')"></label>
        <label class="file-custom" id="lbl-n-layout"><span>üìÇ –ú–∞–∫–µ—Ç</span><input type="file" id="n-layout" onchange="updateFileLabel(this, 'lbl-n-layout')"></label>
      </div>
      
      <textarea id="n-desc" class="custom-input compact-input" style="min-height:60px;" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∏ –Ω—é–∞–Ω—Å—ã –∑–∞–∫–∞–∑–∞..."></textarea>
      
      <hr style="border:0; border-top:1px solid #444; margin:10px 0;">
      
      <label class="input-label">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å)</label>
      <input type="number" id="n-price-final" class="custom-input" style="font-weight:bold; color:var(--green);">
      
      <label class="input-label">–û–ø–ª–∞—á–µ–Ω–æ</label>
      <div style="display:flex; gap:8px;">
        <input type="number" id="n-paid" class="custom-input compact-input" placeholder="0" style="margin-bottom:0;">
        <button class="chip" onclick="quickPay('n', 0.5)">50%</button>
        <button class="chip" onclick="quickPay('n', 1)">100%</button>
      </div>

      <button class="main-btn" id="btn-submit" onclick="submitOrder()" style="margin-top:15px;">üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —Ä–∞–±–æ—Ç—É</button>
      <button class="btn-action" onclick="closeModals()">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <div class="modal" id="modal-edit">
    <div class="modal-content">
      <h3 id="edit-id-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
      
      <label class="input-label">–°—Ç–∞—Ç—É—Å</label>
      <select id="e-status" class="custom-input compact-input" onchange="checkStatusReq()">
        <option value="–ò–∑–≥–æ—Ç–æ–≤–∏—Ç—å">üî¥ –ò–∑–≥–æ—Ç–æ–≤–∏—Ç—å</option>
        <option value="–í —Ä–∞–±–æ—Ç–µ">üîµ –í —Ä–∞–±–æ—Ç–µ</option>
        <option value="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">üü† –û—Ç–ø—Ä–∞–≤–∏—Ç—å</option>
        <option value="–ì–æ—Ç–æ–≤–æ">üü¢ –ì–æ—Ç–æ–≤–æ</option>
      </select>

      <div id="finish-reqs" style="display:none; background:rgba(48, 209, 88, 0.1); padding:10px; border-radius:12px; margin-bottom:10px;">
        <label class="file-custom" id="lbl-e-photo-done"><span>üì∏ –§–æ—Ç–æ –≥–æ—Ç–æ–≤–æ–≥–æ –∏–∑–¥–µ–ª–∏—è</span><input type="file" id="e-photo-done" onchange="updateFileLabel(this, 'lbl-e-photo-done')"></label>
      </div>

      <label class="input-label">–î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞</label>
      <div class="input-row">
        <input type="text" id="e-client" class="custom-input compact-input" placeholder="–ò–º—è">
        <input type="text" id="e-phone" class="custom-input compact-input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
      </div>
      
      <textarea id="e-desc" class="custom-input compact-input" style="min-height:60px;" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞"></textarea>

      <label class="input-label">–î–æ—Å—Ç–∞–≤–∫–∞</label>
      <div class="delivery-chips" id="e-delivery-chips">
        <button class="chip" onclick="selectDelivery('e', 'pickup', this)">–°–∞–º–æ–≤—ã–≤–æ–∑</button>
        <button class="chip" onclick="selectDelivery('e', 'yandex', this)">–Ø–Ω–¥–µ–∫—Å</button>
        <button class="chip" onclick="selectDelivery('e', 'cdek', this)">–°–î–≠–ö</button>
      </div>
      <input type="text" id="e-track" class="custom-input compact-input" placeholder="–ù–∞–∫–ª–∞–¥–Ω–∞—è" style="margin-top:8px;">

      <label class="input-label" style="margin-top:10px;">–§–∞–π–ª—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å)</label>
      <label class="file-custom" id="lbl-e-layout" style="margin-bottom:10px;"><span>üìÇ –ó–∞–º–µ–Ω–∏—Ç—å –º–∞–∫–µ—Ç</span><input type="file" id="e-layout" onchange="updateFileLabel(this, 'lbl-e-layout')"></label>

      <label class="input-label" style="margin-top:10px;">–§–∏–Ω–∞–Ω—Å—ã</label>
      <div style="display:flex; gap:5px;">
        <div style="flex:1">
          <label class="input-label">–¶–µ–Ω–∞</label>
          <input type="number" id="e-price" class="custom-input compact-input">
        </div>
        <div style="flex:1">
           <label class="input-label">–û–ø–ª–∞—á–µ–Ω–æ</label>
           <input type="number" id="e-paid" class="custom-input compact-input">
        </div>
      </div>
      <div style="display:flex; gap:8px; margin-bottom:10px;">
        <button class="chip" style="width:100%" onclick="quickPay('e', 0.5)">50%</button>
        <button class="chip" style="width:100%" onclick="quickPay('e', 1)">100%</button>
      </div>

      <button class="main-btn" id="btn-update" onclick="updateOrder()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      
      <div style="display:flex; gap:10px; margin-top:10px;">
         <button class="btn-action" onclick="closeModals()">–ó–∞–∫—Ä—ã—Ç—å</button>
         <button class="btn-action" onclick="deleteOrder()" style="color:var(--red); border-color:var(--red);">üóë –£–¥–∞–ª–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modal-status">
    <div class="modal-content" style="max-width:300px;">
      <h3 style="text-align:center; margin-bottom:20px;">–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å</h3>
      <div style="display:flex; flex-direction:column; gap:10px;">
        <button class="status-btn-big st-new" onclick="saveStatus('–ò–∑–≥–æ—Ç–æ–≤–∏—Ç—å')">üî¥ –ò–∑–≥–æ—Ç–æ–≤–∏—Ç—å</button>
        <button class="status-btn-big st-work" onclick="saveStatus('–í —Ä–∞–±–æ—Ç–µ')">üîµ –í —Ä–∞–±–æ—Ç–µ</button>
        <button class="status-btn-big st-send" onclick="saveStatus('–û—Ç–ø—Ä–∞–≤–∏—Ç—å')">üü† –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <button class="status-btn-big st-done" onclick="saveStatus('–ì–æ—Ç–æ–≤–æ')">üü¢ –ì–æ—Ç–æ–≤–æ</button>
      </div>
      <button class="btn-action" onclick="closeModals()" style="margin-top:15px;">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <script src="config.js"></script>
  <script src="script.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>CRM SoftMastera v2.2</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #1c1c1e; --card: #2c2c2e; --text: #fff; --hint: #8e8e93; 
      --blue: #0a84ff; --green: #30d158; --red: #ff453a;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, sans-serif; }
    body { background: var(--bg); color: var(--text); padding: 15px; padding-bottom: 90px; overflow-x: hidden; }
    
    .app-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 0 5px; }
    .user-tag { font-size: 13px; color: var(--hint); }
    .logout-btn { background: rgba(255, 255, 255, 0.1); color: var(--text); padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; border: none; }

    .card { background: var(--card); border-radius: 14px; padding: 16px; margin-bottom: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    h1, h3 { text-align: center; color: var(--blue); margin-bottom: 15px; font-weight: bold; }
    
    input, textarea { 
      width: 100%; background: #3a3a3c; border: 1px solid transparent; border-radius: 10px; 
      color: #fff; padding: 12px; margin-bottom: 12px; font-size: 16px; outline: none;
    }
    label { color: var(--hint); font-size: 13px; margin-bottom: 6px; display: block; }
    
    button { border: none; border-radius: 10px; cursor: pointer; font-size: 15px; font-weight: 600; padding: 14px; transition: 0.2s; }
    button:active { transform: scale(0.98); opacity: 0.8; }

    #toast {
      position: fixed; bottom: -100px; left: 20px; right: 20px;
      background: var(--green); color: white; padding: 16px;
      border-radius: 12px; text-align: center; font-weight: 600;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 9999;
      transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    #toast.show { bottom: 30px; }

    .login-screen { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; }
    .role-btn { width: 280px; background: #3a3a3c; color: var(--blue); margin-bottom: 12px; text-align: left; display: flex; justify-content: space-between; align-items: center; padding: 18px; border-radius: 12px; }

    .nav { display: flex; gap: 6px; margin-bottom: 20px; background: #3a3a3c; padding: 4px; border-radius: 12px; }
    .nav-btn { flex: 1; padding: 10px; background: transparent; color: var(--hint); border-radius: 8px; font-size: 13px; }
    .nav-btn.active { background: var(--card); color: var(--blue); }
    .tab { display: none; }
    .tab.active { display: block; }

    .price-big { font-size: 32px; font-weight: 800; color: #fff; text-align: center; margin: 20px 0; }
    
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(4px); }
    .modal.show { display: flex; }
    .modal-content { background: var(--card); width: 100%; max-width: 450px; padding: 24px; border-radius: 18px; position: relative; }
  </style>
</head>
<body>

  <div id="toast">‚úÖ –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!</div>

  <div class="login-screen" id="loginScreen">
    <h1 style="margin-bottom: 30px;">üîê CRM –í—Ö–æ–¥</h1>
    <button class="role-btn" onclick="login('roma', '–†–æ–º–∞ (–¶–µ—Ö)')">–†–æ–º–∞ (–¶–µ—Ö) <span>2222</span></button>
    <button class="role-btn" onclick="login('mikhail', '–ú–∏—Ö–∞–∏–ª (–ú–µ–Ω.)')">–ú–∏—Ö–∞–∏–ª (–ú–µ–Ω–µ–¥–∂–µ—Ä) <span>1234</span></button>
    <button class="role-btn" onclick="login('owner', '–í–ª–∞–¥–µ–ª–µ—Ü')">–í–ª–∞–¥–µ–ª–µ—Ü <span>9999</span></button>
  </div>

  <div id="app" style="display:none;">
    <div class="app-header">
      <span class="user-tag" id="userDisplay">–í—ã: ‚Äî</span>
      <button class="logout-btn" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
    </div>

    <div class="nav" id="navBar">
      <button class="nav-btn active" onclick="setTab('calc')" id="btn-calc">üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</button>
      <button class="nav-btn" onclick="setTab('queue')" id="btn-queue">üìã –û—á–µ—Ä–µ–¥—å</button>
    </div>

    <div class="tab active" id="tab-calc">
      <div class="card">
        <h3>–ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç</h3>
        <label>–®–∏—Ä–∏–Ω–∞ (—Å–º)</label><input type="number" id="c-width" value="100">
        <label>–í—ã—Å–æ—Ç–∞ (—Å–º)</label><input type="number" id="c-height" value="50">
        <label>–õ–∏—Å—Ç–æ–≤ –∞–∫—Ä–∏–ª–∞</label><input type="number" id="c-sheets" value="1.5" step="0.1">
        <div class="price-big" id="c-result">0 ‚ÇΩ</div>
        <button onclick="openOrder()" style="width:100%; background:var(--green); color:white;">üìù –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
      </div>
    </div>

    <div class="tab" id="tab-queue">
      <div class="card" style="text-align:center; padding:40px; color:var(--hint);">
        <div style="font-size: 40px; margin-bottom: 10px;">üìã</div>
        –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –ø—É—Å—Ç.
      </div>
    </div>
  </div>

  <div class="modal" id="orderModal">
    <div class="modal-content">
      <h2 style="color: var(--blue); margin-bottom: 20px;">–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h2>
      <input type="text" id="ord-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
      <input type="text" id="ord-contact" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞">
      <textarea id="ord-desc" rows="3" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."></textarea>
      <div style="display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold;">
        <span>–ò—Ç–æ–≥–æ:</span><span id="modal-price" style="color: var(--green);">0 ‚ÇΩ</span>
      </div>
      <button onclick="submitOrder()" id="subBtn" style="width:100%; background:var(--green); color:white;">üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <button onclick="closeModal()" style="width:100%; background:transparent; color:var(--hint); margin-top:10px;">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <script>
    // –ü–Å–¢–†, –¢–£–¢ –¢–í–û–Ø –ù–û–í–ê–Ø –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –°–°–´–õ–ö–ê:
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxyfKEG2iVZBcc9ZTx0bLud8uQ2kUAADyJEAJrpODfC9wSRCnSAqNgHuP-F1CcQzpZXrw/exec";
    let currentPrice = 0;

    function showToast() {
      const t = document.getElementById('toast');
      t.classList.add('show');
      setTimeout(() => { t.classList.remove('show'); location.reload(); }, 2500);
    }

    function login(role, name) {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      document.getElementById('userDisplay').innerText = "–í—ã: " + name;
      if(role === 'roma') {
          setTab('queue');
          document.getElementById('btn-calc').style.display = 'none';
      } else {
          document.getElementById('btn-calc').style.display = 'block';
          setTab('calc');
      }
      calculate();
    }

    function logout() { location.reload(); }

    function setTab(t) {
      document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
      document.getElementById('tab-'+t).classList.add('active');
      document.getElementById('btn-'+t).classList.add('active');
    }

    function calculate() {
      const w = parseFloat(document.getElementById('c-width').value) || 0;
      const h = parseFloat(document.getElementById('c-height').value) || 0;
      const s = parseFloat(document.getElementById('c-sheets').value) || 0;
      currentPrice = Math.round((w * h / 10000 * 1133) + (s * 600) + 1500);
      document.getElementById('c-result').innerText = currentPrice.toLocaleString() + " ‚ÇΩ";
      document.getElementById('modal-price').innerText = currentPrice.toLocaleString() + " ‚ÇΩ";
    }

    document.querySelectorAll('input').forEach(i => i.addEventListener('input', calculate));

    function openOrder() { document.getElementById('orderModal').classList.add('show'); }
    function closeModal() { document.getElementById('orderModal').classList.remove('show'); }

    function submitOrder() {
      const title = document.getElementById('ord-title').value;
      if(!title) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ!");
      const btn = document.getElementById('subBtn');
      btn.innerText = "‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞..."; btn.disabled = true;

      const data = {
        id: Math.floor(Math.random() * 9000) + 1000,
        title: title,
        contact: document.getElementById('ord-contact').value,
        desc: document.getElementById('ord-desc').value,
        price: currentPrice,
        size: document.getElementById('c-width').value + "x" + document.getElementById('c-height').value,
        sheets: document.getElementById('c-sheets').value
      };

      fetch(WEB_APP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) })
      .then(() => {
        closeModal();
        showToast();
      });
    }
  </script>
</body>
</html>

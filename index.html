<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>CRM SoftMastera v2.0</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #1c1c1e; --card: #2c2c2e; --text: #fff; --hint: #8e8e93; 
      --blue: #0a84ff; --green: #30d158; --red: #ff453a; --orange: #ff9f0a;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, sans-serif; }
    body { background: var(--bg); color: var(--text); padding: 20px; padding-bottom: 90px; }
    
    .card { background: var(--card); border-radius: 14px; padding: 16px; margin-bottom: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    h1, h3 { text-align: center; color: var(--blue); margin-bottom: 15px; }
    
    input, textarea { 
      width: 100%; background: #3a3a3c; border: 1px solid transparent; border-radius: 10px; 
      color: #fff; padding: 12px; margin-bottom: 12px; font-size: 16px; outline: none;
    }
    input:focus { border-color: var(--blue); }
    label { color: var(--hint); font-size: 13px; margin-bottom: 6px; display: block; }
    
    button { border: none; border-radius: 10px; cursor: pointer; font-size: 15px; font-weight: 600; padding: 14px; transition: 0.2s; }
    button:active { transform: scale(0.98); }

    .login-screen { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; }
    .role-btn { width: 280px; background: #3a3a3c; color: var(--blue); margin-bottom: 10px; text-align: left; display: flex; justify-content: space-between; }

    .nav { display: flex; gap: 6px; margin-bottom: 20px; background: #3a3a3c; padding: 4px; border-radius: 12px; }
    .nav-btn { flex: 1; padding: 10px; background: transparent; color: var(--hint); border-radius: 8px; font-size: 13px; }
    .nav-btn.active { background: var(--card); color: var(--blue); }
    .tab { display: none; }
    .tab.active { display: block; }

    .price-big { font-size: 32px; font-weight: 800; color: #fff; text-align: center; margin: 20px 0; }
    .order-card { background: var(--card); border-left: 4px solid var(--blue); padding: 16px; margin-bottom: 12px; border-radius: 12px; }

    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000; align-items: center; justify-content: center; padding: 20px; }
    .modal.show { display: flex; }
    .modal-content { background: var(--card); width: 100%; max-width: 450px; padding: 24px; border-radius: 18px; position: relative; }
  </style>
</head>
<body>

  <div class="login-screen" id="loginScreen">
    <h1>üîê CRM –í—Ö–æ–¥</h1>
    <input type="password" id="loginPass" placeholder="–ü–∞—Ä–æ–ª—å" style="width:280px; text-align:center;">
    <button class="role-btn" onclick="login('roma')">–†–æ–º–∞ (–¶–µ—Ö) <span>2222</span></button>
    <button class="role-btn" onclick="login('mikhail')">–ú–∏—Ö–∞–∏–ª (–ú–µ–Ω–µ–¥–∂–µ—Ä) <span>1234</span></button>
    <button class="role-btn" onclick="login('owner')">–í–ª–∞–¥–µ–ª–µ—Ü <span>9999</span></button>
    <div id="loginErr" style="color:var(--red); display:none; margin-top:10px;">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</div>
  </div>

  <div id="app" style="display:none;">
    <div class="nav">
      <button class="nav-btn active" onclick="setTab('calc')" id="btn-calc">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</button>
      <button class="nav-btn" onclick="setTab('queue')" id="btn-queue">–û—á–µ—Ä–µ–¥—å</button>
    </div>

    <div class="tab active" id="tab-calc">
      <div class="card">
        <h3>–ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç</h3>
        <label>–®–∏—Ä–∏–Ω–∞ (—Å–º)</label><input type="number" id="c-width" value="100">
        <label>–í—ã—Å–æ—Ç–∞ (—Å–º)</label><input type="number" id="c-height" value="50">
        <label>–õ–∏—Å—Ç–æ–≤ –∞–∫—Ä–∏–ª–∞</label><input type="number" id="c-sheets" value="1.5">
        <div class="price-big" id="c-result">0 ‚ÇΩ</div>
        <button onclick="openOrder()" style="width:100%; background:var(--green); color:white;">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
      </div>
    </div>

    <div class="tab" id="tab-queue">
      <div id="ordersList" style="text-align:center; color:var(--hint); padding:20px;">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>
    </div>
  </div>

  <div class="modal" id="orderModal">
    <div class="modal-content">
      <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
      <input type="text" id="ord-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
      <input type="text" id="ord-contact" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞">
      <textarea id="ord-desc" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."></textarea>
      <button onclick="submitOrder()" id="subBtn" style="width:100%; background:var(--green); color:white;">üöÄ –í –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</button>
      <button onclick="closeModal()" style="width:100%; background:transparent; color:var(--hint); margin-top:10px;">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <script>
    // –í–ê–®–ê –°–°–´–õ–ö–ê –ò–ó GOOGLE
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxyfKEG2iVZBcc9ZTx0bLud8uQ2kUAADyJEAJrpODfC9wSRCnSAqNghuP-F1CcQzpZXRw/exec";

    const USERS = { 'roma': '2222', 'mikhail': '1234', 'owner': '9999' };
    let currentPrice = 0;

    function login(u) {
      if(document.getElementById('loginPass').value === USERS[u]) {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        calculate();
      } else { alert('–û—à–∏–±–∫–∞'); }
    }

    function setTab(t) {
      document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
      document.getElementById('tab-'+t).classList.add('active');
    }

    function calculate() {
      const w = document.getElementById('c-width').value;
      const h = document.getElementById('c-height').value;
      const s = document.getElementById('c-sheets').value;
      currentPrice = Math.round((w * h / 10000 * 1133) + (s * 600) + 1500);
      document.getElementById('c-result').innerText = currentPrice + " ‚ÇΩ";
    }

    document.querySelectorAll('input').forEach(i => i.addEventListener('input', calculate));

    function openOrder() { document.getElementById('orderModal').classList.add('show'); }
    function closeModal() { document.getElementById('orderModal').classList.remove('show'); }

    function submitOrder() {
      const title = document.getElementById('ord-title').value;
      if(!title) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ!");
      
      const btn = document.getElementById('subBtn');
      btn.innerText = "–û—Ç–ø—Ä–∞–≤–∫–∞..."; btn.disabled = true;

      const data = {
        id: Math.floor(Math.random() * 9000) + 1000,
        title: title,
        contact: document.getElementById('ord-contact').value,
        desc: document.getElementById('ord-desc').value,
        price: currentPrice,
        size: document.getElementById('c-width').value + "x" + document.getElementById('c-height').value,
        sheets: document.getElementById('c-sheets').value
      };

      fetch(WEB_APP_URL, {
        method: 'POST',
        mode: 'no-cors',
        body: JSON.stringify(data)
      }).then(() => {
        alert("–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
        location.reload();
      });
    }
  </script>
</body>
</html>